// SPDX-License-Identifier: MIT
pragma solidity ^0.8.10;

import "./ProofLib.sol";

contract MassUpdateVerifier {
    using ProofLib for ProofLib.G1Point;
    using ProofLib for ProofLib.G2Point;

    function massUpdateVerifyingKey() internal pure returns (ProofLib.VerifyingKey memory vk) {
        vk.alfa1 = ProofLib.G1Point(
            20491192805390485299153009773594534940189261866228447918068658471970481763042,
            9383485363053290200918347156157836566562967994039712273449902621266178545958
        );

        vk.beta2 = ProofLib.G2Point(
            [4252822878758300859123897981450591353533073413197771768651442665752259397132,
             6375614351688725206403948262868962793625744043794305715222011528459656738731],
            [21847035105528745403288232691147584728191162732299865338377159692350059136679,
             10505242626370262277552901082094356697409835680220590971873171140371331206856]
        );
        vk.gamma2 = ProofLib.G2Point(
            [11559732032986387107991004021392285783925812861821192530917403151452391805634,
             10857046999023057135944570762232829481370756359578518086990519993285655852781],
            [4082367875863433681332203403145435568316851327593401208105741076214120093531,
             8495653923123431417604973247489272438418190587263600148770280649306958101930]
        );
        vk.delta2 = ProofLib.G2Point(
            [15198590077594805703681178308277827706956225854691754432713019821242856405613,
             20454911115955213163612063443489081089285660107617426921889354109213026318306],
            [1446141072364651688638197567275453004602946932022107447130975572923835383895,
             9138383494168197587705404357278667071130743058358006156556481053812175499086]
        );
        vk.IC = new ProofLib.G1Point[](59);

        vk.IC[0] = ProofLib.G1Point(
            15080134703581416738137648429730896949705915070869206432885755126975562603616,
            6543999197328430811062485579695151836069010709089218471247393330305319049646
        );

        vk.IC[1] = ProofLib.G1Point(
            20737110283233047823790774884477403677343139310146639842373009990045162897050,
            16212058625229093603102751080532935961545182530135916695570411481351656842485
        );

        vk.IC[2] = ProofLib.G1Point(
            12771668532214405282501244253077409917447534089904580994019236056329461212082,
            12845518361313519621218553953967445087355378429687248561139594805471061541742
        );

        vk.IC[3] = ProofLib.G1Point(
            5382043726487200901830177815170644900733695813560611420316677247249801793749,
            12258372961562882319533037109554664501919879247182603694735390661119662391459
        );

        vk.IC[4] = ProofLib.G1Point(
            16679402566843635433411234262402324387138198550209994749320251148697495986508,
            468751095356566428575774344102593494069501855140318026063276803149674277709
        );

        vk.IC[5] = ProofLib.G1Point(
            4770385518273324135638642436443000612672845878696558934056290532812323092349,
            16517097678313818365875587255775356562639860078293356115030878711442259263590
        );

        vk.IC[6] = ProofLib.G1Point(
            21294811643326416770619437276104966981989361053164525119574378014512357639298,
            14355012540311411448248243745155036504273508345944322890912184685062413580206
        );

        vk.IC[7] = ProofLib.G1Point(
            6049420521991794648071349200087122561798641858437111266060477557743224484221,
            4879875935526918627061608082039415377526003735283966052709275726264731274197
        );

        vk.IC[8] = ProofLib.G1Point(
            2569823327224974461773096209851681550776561753308964537335279201014608094859,
            2584137411795844404626959529547584800653966290623004110081298851197128217826
        );

        vk.IC[9] = ProofLib.G1Point(
            1224025920730501576426231049989225636008605913801775420680900046366014223629,
            19672554345974508066288536839714032573831987008163250153012659299617886757232
        );

        vk.IC[10] = ProofLib.G1Point(
            762629549443196084329473329229196024523745027607071230221195068921575554736,
            9881156652111842997960198806321583395664911540156039639095637595292492374621
        );

        vk.IC[11] = ProofLib.G1Point(
            8597363999791225743366915598399328354289208444640401161648800326263796986229,
            12766616802517816020534319671757957105450009467282870787797232088547334479088
        );

        vk.IC[12] = ProofLib.G1Point(
            5142779492512132420929382661879245992853303243259867156800481440142611493631,
            16173689606863768262473243610728174847849752483456010415920150521136981633154
        );

        vk.IC[13] = ProofLib.G1Point(
            21076404171399020463499545140926360523083729645615015604725711473046310074533,
            20447143522987373377540562421171861428419784506341308455324418090321908974169
        );

        vk.IC[14] = ProofLib.G1Point(
            16886873017932833421216116099069383349799013855741992790106841615906556761406,
            14013207674988840171509087822673921128595169173820838944816507516113033241296
        );

        vk.IC[15] = ProofLib.G1Point(
            10395467205340415064292020551768507426124870111817558580217846531135075883835,
            1271354327149974891253014437679736334812056995436629757842009575333458876028
        );

        vk.IC[16] = ProofLib.G1Point(
            9530522619992828232945341015721383772233768628408079215271956504653132017287,
            1418562420296914546602083267369344280997437952921955925228710276126253948775
        );

        vk.IC[17] = ProofLib.G1Point(
            17350328016758254835525640226879038102532733483655117331125762387890395841124,
            4575238514810704917728348269253404185881786998604508702703709135004575952721
        );

        vk.IC[18] = ProofLib.G1Point(
            85815745986768800387011680209533240523493609630190013309609281765659093916,
            15801490565183770170556534922071751103547134437508947401882161336858446983060
        );

        vk.IC[19] = ProofLib.G1Point(
            17697786570375380782528465323533526043065534872463411370073744596241616431344,
            9020500284444995403126090316104618369403520965944968401266090297740473195683
        );

        vk.IC[20] = ProofLib.G1Point(
            14885502382774739266971042579393861060883897408985025744229109826293563795579,
            19765129022398564165259285873115593682910589059521507529265233359473781254196
        );

        vk.IC[21] = ProofLib.G1Point(
            17245292816173837395302691887707572912781824441153638613343725406507403251361,
            10743057761448714707331025455787449575342234068689465508106996569919467956051
        );

        vk.IC[22] = ProofLib.G1Point(
            5004226016698662584212680012133342884373652472832218856887027764999727606924,
            6480787189791567781416652601443524456415060017396738039743677998501508932784
        );

        vk.IC[23] = ProofLib.G1Point(
            17417175913257227058480917718459407492383433241756964958137342394276994050294,
            178763811055732794064304838133760535643494283260273737369612313794080171381
        );

        vk.IC[24] = ProofLib.G1Point(
            6564143851458992128388953824031122057846510089970813010966606132231283896751,
            5027123621565899121541661798284684475665790140871768562026757720723047475204
        );

        vk.IC[25] = ProofLib.G1Point(
            21414597877388590577747112017187578996921454785047599329744710670412142176210,
            3526044375816212574613667515743964491735733824325539999139538417662868690446
        );

        vk.IC[26] = ProofLib.G1Point(
            17725414254266669478682107789306859823542980911203175417848517392245561628998,
            2858355299431292798140960182431610165247672169472595802595012536224077123005
        );

        vk.IC[27] = ProofLib.G1Point(
            21491517326067007277628903889547411018484466374021658736968782794924650735853,
            10716818206088900068215347716441429336455059758175099955653963278901817469501
        );

        vk.IC[28] = ProofLib.G1Point(
            21672396449725236410220985744201430666067859758040811940073414302131049985099,
            21244769717660945282298675045215994376883203535354690933896765876244393515810
        );

        vk.IC[29] = ProofLib.G1Point(
            17030411200516225968573252412326431688744882150760516005306945712464879411484,
            20988959940889753618898647268394768199838393925071815659547500215694470745427
        );

        vk.IC[30] = ProofLib.G1Point(
            19792311406346115152117008814262079315586108073595572683818505161449742054555,
            9942609468594390395354302213210182676591712710938328168442939837249113486886
        );

        vk.IC[31] = ProofLib.G1Point(
            12523512444662347043759164915201255722006617933021772140960205775191331889115,
            17896710885593294108801596514999605128433698763718947471025850220131104641057
        );

        vk.IC[32] = ProofLib.G1Point(
            17079395151054800135896709418619095267983920173707171154847268483264483780886,
            20094020542809399092633006797938791264906908989498443414456366394987341451604
        );

        vk.IC[33] = ProofLib.G1Point(
            2562769303071780726300388686461660873674016466688471072895887637882877840479,
            18596762909083559091442947263831199983983293165468790757073470471606158867100
        );

        vk.IC[34] = ProofLib.G1Point(
            4057053010358638618402161990649474995859832169183142967245917153856299500887,
            10396386150697222148473449385790110675371581471031149598153597090208865053354
        );

        vk.IC[35] = ProofLib.G1Point(
            11880105685908806551696984859182441343580401385057231764433950455919708268753,
            5862608825780296491860101762393666549370451509028089344582191741524226130690
        );

        vk.IC[36] = ProofLib.G1Point(
            17827831998216396757916155921403946873977327994477064736303754632548379889840,
            7952515236141862302074557521316185397988684765303100117344110467119872146718
        );

        vk.IC[37] = ProofLib.G1Point(
            16067741536776817454333302926132850457338314498184241386663849284160782396710,
            2954737453966837670231508541615180476308238648622384063698135111318161685172
        );

        vk.IC[38] = ProofLib.G1Point(
            15937997908639577895798365736522580972280572564539739394454234655414736434026,
            8215171898630999426613893486488793760173241129864151971583945431406094932573
        );

        vk.IC[39] = ProofLib.G1Point(
            6570697492390104467787036134321839617669660990743994471479456668832913150488,
            4735435413674689569130753928189879234996228666461234915654279367369886085330
        );

        vk.IC[40] = ProofLib.G1Point(
            17424705341715711366927977878093421822676361990108151418221872158732358392183,
            3992930721674028755629612213294004318824841943871018192866595904057645421278
        );

        vk.IC[41] = ProofLib.G1Point(
            18247807232600835030223542343193867033170999284033496012260025524048918521421,
            7461952144775253320199773033218315412650439603072575758370287108748529352890
        );

        vk.IC[42] = ProofLib.G1Point(
            3324547134020248172846182522860210313783575283511308538765612698812335846439,
            17871739158497803205895092488224336838425927402841045060031728812919099241012
        );

        vk.IC[43] = ProofLib.G1Point(
            9880467560066541533809499436232041198854324812886268492886696300428837636544,
            13530754821802070282126963511809516619097523584393543303831096834900885070315
        );

        vk.IC[44] = ProofLib.G1Point(
            8894641090021043824226829048134009298174453894624783622344624411498731873053,
            7041348236504578748451038552362091851190723093793045137902630062524075223681
        );

        vk.IC[45] = ProofLib.G1Point(
            18440525681739622101146975602003513340532889180107902791618585492765608921885,
            16959145842661443326218448122271434253871110124916647625306214288763269423721
        );

        vk.IC[46] = ProofLib.G1Point(
            16242061722666788005309939924008739333064619700644022626521371239943952199819,
            15620681740619129068813237590027722027650650560700698026184751102064426984029
        );

        vk.IC[47] = ProofLib.G1Point(
            3260339263024843691960301126263057958381584980518001883558929709449732778950,
            2595116154955484289454983652809474121468895136937790393268017110600929096613
        );

        vk.IC[48] = ProofLib.G1Point(
            17887146289013627808300920980505057425006641686194783317522669947371839286487,
            15194212059262941783600307336562394234939356251429249269015001671083699609570
        );

        vk.IC[49] = ProofLib.G1Point(
            2663307156555042915593732903065926435320099659673877136394637689667293970299,
            17473548946427846649636838829181600864266541034206112776450851504169853979539
        );

        vk.IC[50] = ProofLib.G1Point(
            14124390002429927035141866684461004110586261397546314858470561541140650663294,
            12827472833557790705123774712370797532236371664703364856062588643140927133158
        );

        vk.IC[51] = ProofLib.G1Point(
            3336502267042118021078999209747692142180300972632821789057988299451398271214,
            8787467831136537579260214838981114548271002495699381646267564034961471592135
        );

        vk.IC[52] = ProofLib.G1Point(
            2693484783267790656195730777720531813509677111914186176105241896913237085550,
            1163064639619065165296056073464821345888168710733458166616085399461512977050
        );

        vk.IC[53] = ProofLib.G1Point(
            19704478201034768468972837591661059824990614132891396990643157826644284715781,
            7827842000351727247561345225317996162667835438910418351389487775866884165874
        );

        vk.IC[54] = ProofLib.G1Point(
            17284058158422688189920737383042816546511012483897547353406639829639053783182,
            50870814627534635874113858738075505155571651763033179197411209349713522062
        );

        vk.IC[55] = ProofLib.G1Point(
            1483146814768001236250746089229277980062830088610046019870115371821761648276,
            515919149122496224421394286321958898149746555682139556633479129611832095982
        );

        vk.IC[56] = ProofLib.G1Point(
            18537329726613497869312579211921083074715686510093853194872285111382700625311,
            12552051189425997389449391009530835376854029470179994537161850915360139352862
        );

        vk.IC[57] = ProofLib.G1Point(
            15537025770465696856101132164569468249310911367102002391344970073916976957300,
            21581020789615963137295761935106157089513551631665732784315470328290353411654
        );

        vk.IC[58] = ProofLib.G1Point(
            326465067999828819392346344586769957778541175335740784136233709476400992846,
            12581949818124759178359286811176539116378201204524017349583326166636229915570
        );
    }

    function _verifyMassUpdateProof(
        uint[8] calldata p,
        uint[58] memory input
    ) internal view returns (bool) {
        ProofLib.Proof memory proof;
        proof.A = ProofLib.G1Point(p[0], p[1]);
        proof.B = ProofLib.G2Point([p[2], p[3]], [p[4], p[5]]);
        proof.C = ProofLib.G1Point(p[6], p[7]);
        ProofLib.VerifyingKey memory vk = massUpdateVerifyingKey();
        ProofLib.G1Point memory vk_x = ProofLib.G1Point(0, 0);
        for (uint i = 0; i < 58;) {
            if (input[i] >= ProofLib.snark_scalar_field)
                revert ProofLib.GteSnarkScalarField();
            vk_x = vk_x.addition(vk.IC[i+1].scalar_mul(input[i]));
            unchecked { i += 1; }
        }
        vk_x = vk_x.addition(vk.IC[0]);
        return proof.A.negate().pairingProd4(
            proof.B,
            vk.alfa1,
            vk.beta2,
            vk_x,
            vk.gamma2,
            proof.C,
            vk.delta2
        );
    }
}